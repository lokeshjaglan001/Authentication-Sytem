<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>

<body class="bg-gray-800 flex flex-col">
    <navbar class="flex bg-gray-900 text-white h-15">
        <div class="left flex ml-3 gap-2 ">
            <img src="<%= user.profilepic && user.profilepic.data? `data:${user.profilepic.contentType};base64,${user.profilepic.data.toString('base64')}`: '/public/temp/default.webp' %>" alt="User Avatar" class="w-10 h-10 object-cover rounded-full my-auto"/>
            <div class="my-auto font-bold"><%= user.username %></div>
        </div>
        <div class="right flex my-auto ml-auto mr-3 gap-3">
            <a href="/edit/<%=user._id%>"><img src="../../public/edit.svg" alt="" class="h-5 w-5 mt-2"></a>
            <a href="/logout"><img src="../../public/logout.svg" alt="" class="h-5 w-5 mt-2"></a>
            <a href="#" onclick="deleteUser('<%= user._id %>')"><img src="../../public/delete.svg" alt="" class="h-5 w-5 mt-2"></a>
            <a href="/postpage" class="text-white h-9 bg-green-500 rounded-md px-2 py-1">Create Post</a>
        </div>
    </navbar>
    <div class="posts mt-10 flex flex-wrap text-white ml-2">
        <% posts.reverse().forEach(function(post){%>
            <div class="post m-2 <%= post.username.username === user.username ? 'border-blue-500':'border-zinc-700' %> w-32/100 rounded-md bg-zinc-800 border-[1px] px-3 py-2">
            <h1 class="text-blue-500">@<%= post.username.username%></h1>
            <h1 class="text-xl"><%= post.title%></h1>
            <p><%= post.content%></p>
            <% if (post.likes && post.likes.length !== undefined) { %>
            <small><%= post.likes.length %></small>
            <% } else { %>
            <small>0</small>
            <% } %>
            <div class="btns flex gap-4 ">
                <button class="text-red-500" onclick="like('<%= post.id%>')" id="<%= post.id%>" href="#">
                   <%= (post.likes || []).indexOf(user._id) !== -1 ? 'UnLike' : 'Like' %>
                </button>
                <% if (post.username.username === user.username) {%>
                    <a href="/editPost/<%=post._id%>" class="text-zinc-600">Edit</a>
                <% } else {%>
                    
                <% } %>
            </div>
        </div>
        <%})%>
    </div>
</body>
<script>
        async function deleteUser(id) {
            if (!confirm("Are you sure you want to delete this user?")) return;

            const response = await fetch(`/delete/${id}`, {
                method: "DELETE"
            });

            if (response.ok) {
                alert("User deleted successfully!");
                window.location.href = "/login"; // Redirect after deletion
            } else {
                alert("Failed to delete user.");
            }
        }

        async function like(id) {
            const btn = document.getElementById(id);
            btn.innerText = "Waiting...";
            btn.ariaDisabled = true;
            const response = await fetch(`/like/${id}`);

            if (response.ok) {
                btn.innerText = "UnLike";
            }
            btn.ariaDisabled = false;
        }
</script>
</html>